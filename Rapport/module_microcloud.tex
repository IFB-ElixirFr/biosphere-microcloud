\chapter{Module \micWEBdeployVer}

\todo[inline]{Ajouter une section sur les scripts côté serveur qui permettent d'installer le logiciel.}

Ce module contient les scripts utilisés pour gérer les logiciels et les données nécessaires pour déployer MicroCloud (voir~\autoref{chap:creer_nouvelle_version}).
C'est une version de développement basée sur \module[1.0]{micWEBdeploy}.

Il est constitué des scripts suivants:
\begin{description}
	\item[\script{microscopeRelease.py}]: copie le code du web, compile le code JavaScript (avec \script{microscopeCompileJS.sh}), copie les schémas de certaines bases et les données minimales de certaines bases.
	\item[\script{microscopeCopyOid.py}]: permet de copier les données de l'organisme \textit{Acinetobacter baylyi} (O\_id=31)
	\item[\script{createModulesTarball.py}]: créé les archives des modules à importer dans MicroCloud.
\end{description}

\section{\script{microscopeRelease.py}}

Les schémas copiés sont: pkgdb, REFSEQDB, GO\_Conf, GO\_RES, GO\_CPD, PUB\_CPD et PRESTATIONDB.

Les données copiées sont: pkgdb, GO\_RES et GO\_Conf.\todo{Préciser les données copiées + lien vers la page wiki}

\section{\script{createModulesTarball.py}}

Créé les liens symboliques dans \path{/env/cns/wwwext/html/agc/ftp/MicroCloud}.
\newline
Créé le fichier \path{modules.txt} dans \path{/env/cns/wwwext/html/agc/ftp/MicroCloud}
\newline
Puis la VM master importe les modules listés dans modules.txt (voir \url{https://github.com/IFB-ElixirFr/biosphere-microcloud/blob/master/master/import_modules.sh}).

\begin{lstlisting}[style=bash]
createModulesTarball.py --modules_list bagsub-2.4.3 AGCScriptToolMic-2.0 micGenome-7.0.0 micJBPMwrapper-3.10.8 micPrestation-2.0 micDirecton-1.0
\end{lstlisting}

\section{microscopeCopyOid.py}

\begin{mycolorbox}
	Pour le moment seules les données concernant l'O\_id 31 peuvent être récupérées avec le script microscopeCopyOid.py car certains organismes ont besoin de tables spécifiques de la base GO\_SPE (typiquement la table acineto\_KO pour Acinetobacter baylyi).
\end{mycolorbox}

\begin{lstlisting}[style=bash]
microscopeCopyOid.py --oid 31 --output /env/cns/wwwext/html/agc/ftp/MicroCloud/microscope_31.tar.gz
\end{lstlisting}

\section{microscopeCreateDBschemas.py}
A permis de générer les .sql utilisés pour créer les schémas des bases de données dans la VM permanente.

\begin{lstlisting}[style=bash]
microscopeCreateDBschemas.py --output /env/cns/wwwext/html/agc/ftp/MicroCloud/DBschemas.tar.gz
\end{lstlisting}

\section{taxonomyDBCopyTaxId.py}
Permet de copier les données de la base TAXONOMYDB pour un tax\_id donné.

\begin{lstlisting}[style=bash]
taxonomyDBCopyTaxId.py --tax_id 202950 --output /env/cns/wwwext/html/agc/ftp/MicroCloud/taxonomyDBCopyTaxId.tar.gz
\end{lstlisting}